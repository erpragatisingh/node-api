{"version":3,"file":"MsNodeSqWrapperModule.js","sourceRoot":"","sources":["MsNodeSqWrapperModule.ts"],"names":[],"mappings":"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","sourcesContent":["\r\n\r\nimport {SqlClient, Error, Meta, EventColumnCb, PreparedStatement, Query, Connection} from \"msnodesqlv8\";\r\n\r\n/**\r\n * Created by Stephen on 1/22/2017.\r\n */\r\n\r\nexport module MsNodeSqlWrapperModule {\r\n\r\n    const legacyDriver: SqlClient = require('msnodesqlv8');\r\n\r\n    export class SqlModuleWrapperError implements Error {\r\n        constructor(public message: string) {\r\n        }\r\n\r\n        sqlstate: string = \"\";\r\n        code: number = 0;\r\n    }\r\n\r\n    export interface queryCb<T> { (v: T): void\r\n    }\r\n\r\n    export enum SqlCommandType\r\n    {\r\n        None,\r\n        QueryObjectFormat,\r\n        QueryRawFormat,\r\n        StoredProcedure,\r\n        PreparingStatement,\r\n        PreparedStatement\r\n    }\r\n\r\n    export class SqlCommand {\r\n\r\n        constructor(public connection: SqlConnection, public id ?: string, public commandType: SqlCommandType = SqlCommandType.QueryObjectFormat) {\r\n        }\r\n\r\n        _driverTimeoutMs: number | undefined;\r\n        _wrapperTimeoutMs: number | undefined;\r\n        _sql: string | undefined;\r\n        _procedure: string | undefined;\r\n\r\n        _inputParams: any[] | undefined;\r\n\r\n        _onMeta: queryCb<Meta> | undefined;\r\n        _onColumn: EventColumnCb | undefined;\r\n        _onRowCount: queryCb<number> | undefined;\r\n        _onRow: queryCb<number> | undefined;\r\n        _onDone: queryCb<any> | undefined;\r\n        _onSubmitted: queryCb<any> | undefined;\r\n        _onError: queryCb<string> | undefined;\r\n        _onClosed: queryCb<string> | undefined;\r\n\r\n        _query: Query | undefined;\r\n        _preparedStatement: PreparedStatement | undefined;\r\n\r\n        public isPrepared(): boolean {\r\n            return this.commandType == SqlCommandType.PreparingStatement;\r\n        }\r\n\r\n        public sql(s: string): SqlCommand {\r\n            this._sql = s;\r\n            if (this.commandType == SqlCommandType.None)\r\n                this.commandType = SqlCommandType.QueryObjectFormat;\r\n            return this;\r\n        }\r\n\r\n        public params(v: any[]): SqlCommand {\r\n            this._inputParams = v;\r\n            return this;\r\n        }\r\n\r\n        public param(v: any): SqlCommand {\r\n            if (this._inputParams == null) {\r\n                this._inputParams = [];\r\n            }\r\n            this._inputParams.push(v);\r\n            return this;\r\n        }\r\n\r\n        public procedure(s: string): SqlCommand {\r\n            this._procedure = s;\r\n            this.commandType = SqlCommandType.StoredProcedure;\r\n            this.unsubscribe();\r\n            return this;\r\n        }\r\n\r\n        public rawFormat(): SqlCommand {\r\n            this.commandType = SqlCommandType.QueryRawFormat;\r\n            return this;\r\n        }\r\n\r\n        public wrapperTimeoutMs(to: number): SqlCommand {\r\n            this._wrapperTimeoutMs = to;\r\n            return this;\r\n        }\r\n\r\n        public driverTimeoutMs(to: number): SqlCommand {\r\n            this._driverTimeoutMs = to;\r\n            return this;\r\n        }\r\n\r\n        public onMeta(cb: queryCb<Meta>): SqlCommand {\r\n            this._onMeta = cb;\r\n            return this;\r\n        }\r\n\r\n        public onColumn(cb: EventColumnCb): SqlCommand {\r\n            this._onColumn = cb;\r\n            return this;\r\n        }\r\n\r\n        public onRowCount(cb: queryCb<number>): SqlCommand {\r\n            this._onRowCount = cb;\r\n            return this;\r\n        }\r\n\r\n        public onRow(cb: queryCb<number>): SqlCommand {\r\n            this._onRow = cb;\r\n            return this;\r\n        }\r\n\r\n        public onDone(cb: queryCb<any>): SqlCommand {\r\n            this._onDone = cb;\r\n            return this;\r\n        }\r\n\r\n        public onSubmitted(cb: queryCb<any>): SqlCommand {\r\n            this._onSubmitted = cb;\r\n            return this;\r\n        }\r\n\r\n        public onError(cb: queryCb<string>): SqlCommand {\r\n            this._onError = cb;\r\n            return this;\r\n        }\r\n\r\n        public onClosed(cb: queryCb<string>): SqlCommand {\r\n            this._onClosed = cb;\r\n            return this;\r\n        }\r\n\r\n        public unsubscribe(): void {\r\n            this._onMeta = undefined;\r\n            this._onColumn = undefined;\r\n            this._onRowCount = undefined;\r\n            this._onRow = undefined;\r\n            this._onDone = undefined;\r\n            this._onError = undefined;\r\n            this._onClosed = undefined;\r\n        }\r\n\r\n        private subscribe(): void {\r\n\r\n            let query = this._query;\r\n\r\n            if (query) {\r\n                if (this._onMeta != null) {\r\n                    query.on('meta', (m:any) => this._onMeta(m));\r\n                }\r\n                if (this._onColumn != null) {\r\n                    query.on('column', (c:any, d:any, m:any) => this._onColumn(c, d, m));\r\n                }\r\n                if (this._onRowCount != null) {\r\n                    query.on('rowCount', (m:any) => this._onRowCount(m));\r\n                }\r\n                if (this._onRow != null) {\r\n                    query.on('row', (m:any) => this._onRow(m));\r\n                }\r\n                if (this._onDone != null) {\r\n                    query.on('done', m => this._onDone(m));\r\n                }\r\n                if (this._onError != null) {\r\n                    query.on('error', m => this._onError(m));\r\n                }\r\n                if (this._onClosed != null) {\r\n                    query.on('closed', m => this._onClosed(m));\r\n                }\r\n                if (this._onSubmitted != null) {\r\n                    query.on('submitted', m => this._onSubmitted(m));\r\n                }\r\n            }            \r\n        }\r\n\r\n        public subscribing(): boolean {\r\n            return this._onMeta != null\r\n                || this._onSubmitted != null\r\n                || this._onColumn != null\r\n                || this._onRowCount != null\r\n                || this._onRow != null\r\n                || this._onDone != null\r\n                || this._onError != null\r\n                || this._onClosed != null\r\n        }\r\n\r\n        private execProcedure(resolve: Function, reject: Function, res: SqlCommandResponse): void {\r\n            let timeout = this._driverTimeoutMs > 0 ? this._driverTimeoutMs / 1000 : 0;\r\n            let pm = this.connection.legacy_conn.procedureMgr();\r\n            pm.setTimeout(timeout);\r\n            pm.callproc(this._procedure, this._inputParams, (err?: Error, rows?: any[], outputParams?: any[]) => {\r\n                if (err) {\r\n                    res.error = err;\r\n                    reject(res);\r\n                }\r\n                else {\r\n                    res.aggregate(rows);\r\n                    res.outputParams = outputParams;\r\n                    resolve(res);\r\n                }\r\n            });\r\n        }\r\n\r\n        private execQuery(resolve: Function, reject: Function, res: SqlCommandResponse): void {\r\n            let timeout = this._driverTimeoutMs > 0 ? this._driverTimeoutMs / 1000 : 0;\r\n            this._query = this.connection.legacy_conn.query({\r\n                query_str: this._sql,\r\n                query_timeout: timeout\r\n            }, this._inputParams, (err: Error, rows: any[], more: boolean) => {\r\n                if (err) {\r\n                    res.error = err;\r\n                    reject(res);\r\n                } else {\r\n                    res.aggregate(rows);\r\n                    if (!more) resolve(res);\r\n                }\r\n            });\r\n        }\r\n\r\n        private execQueryRaw(resolve: Function, reject: Function, res: SqlCommandResponse): void {\r\n            let timeout = this._driverTimeoutMs > 0 ? this._driverTimeoutMs / 1000 : 0;\r\n            this._query = this.connection.legacy_conn.queryRaw({\r\n                query_str: this._sql,\r\n                query_timeout: timeout\r\n            }, this._inputParams, (err?: Error, rawData?: RawData, more?: boolean) => {\r\n                if (err) {\r\n                    res.error = err;\r\n                    reject(res);\r\n                } else {\r\n                    res.aggregateRaw(rawData);\r\n                    if (!more) resolve(res);\r\n                }\r\n            });\r\n        }\r\n\r\n        private execPrepared(resolve: Function, reject: Function, res: SqlCommandResponse): void {\r\n            this._preparedStatement.preparedQuery(\r\n                this._inputParams, (err: Error, rows: any[], more: boolean) => {\r\n                    if (err) {\r\n                        res.error = err;\r\n                        reject(res);\r\n                    } else {\r\n                        res.aggregate(rows);\r\n                        if (!more) resolve(res);\r\n                    }\r\n                });\r\n        }\r\n\r\n        public cancel(): Promise<SqlCommand> {\r\n            return new Promise((resolve, reject) => {\r\n                let inst = this;\r\n                if (!this._query) {\r\n                    reject(new SqlModuleWrapperError('can only cancel a submitted query.'));\r\n                    return;\r\n                }\r\n                this._query.cancelQuery(err => {\r\n                    if (!err) reject(new SqlModuleWrapperError(`failed to cancel: ${err.message}`));\r\n                    resolve(inst);\r\n                })\r\n            });\r\n        }\r\n\r\n        public freePrepared(): Promise<SqlCommand> {\r\n            return new Promise((resolve, reject) => {\r\n                let inst = this;\r\n                if (this.commandType != SqlCommandType.PreparedStatement) {\r\n                    reject(new SqlModuleWrapperError('freePrepared must be called on prepared command.'));\r\n                    return;\r\n                }\r\n                this._preparedStatement.free(() => {\r\n                    inst._preparedStatement = null;\r\n                    inst.commandType = SqlCommandType.None;\r\n                    resolve(inst);\r\n                })\r\n            });\r\n        }\r\n\r\n        public prepare(): Promise<SqlCommand> {\r\n            return new Promise((resolve, reject) => {\r\n                if (this._sql == null) {\r\n                    reject(new SqlModuleWrapperError('prepare must be called after sql() with sql to prepare.'));\r\n                    return;\r\n                }\r\n                if (this.commandType == SqlCommandType.PreparingStatement) {\r\n                    reject(new SqlModuleWrapperError('prepare is preparing and must be called once only on a command.'));\r\n                    return;\r\n                }\r\n                if (this._preparedStatement != null) {\r\n                    reject(new SqlModuleWrapperError('this command has previously been prepared.'));\r\n                    return;\r\n                }\r\n                this.commandType = SqlCommandType.PreparingStatement;\r\n                this.unsubscribe();\r\n                let inst = this;\r\n                this.connection.legacy_conn.prepare(this._sql, (err?: Error, statement?: PreparedStatement) => {\r\n                    if (err) {\r\n                        reject(err);\r\n                        inst.commandType = SqlCommandType.None;\r\n                    } else {\r\n                        inst._preparedStatement = statement;\r\n                        inst.commandType = SqlCommandType.PreparedStatement;\r\n                        resolve(inst);\r\n                    }\r\n                })\r\n            });\r\n        }\r\n\r\n        private dispatchCommandType(resolve: Function, reject: Function, res: SqlCommandResponse): void {\r\n            switch (this.commandType) {\r\n\r\n                case SqlCommandType.QueryObjectFormat: {\r\n                    this.execQuery(resolve, reject, res);\r\n                    break;\r\n                }\r\n\r\n                case SqlCommandType.QueryRawFormat: {\r\n                    this.execQueryRaw(resolve, reject, res);\r\n                    break;\r\n                }\r\n\r\n                case SqlCommandType.StoredProcedure: {\r\n                    this.execProcedure(resolve, reject, res);\r\n                    break;\r\n                }\r\n\r\n                case SqlCommandType.PreparingStatement: {\r\n                    res.error = new SqlModuleWrapperError(`statement not yet prepared.`);\r\n                    break;\r\n                }\r\n\r\n                case SqlCommandType.PreparedStatement: {\r\n                    this.execPrepared(resolve, reject, res);\r\n                    break;\r\n                }\r\n\r\n                default: {\r\n                    res.error = new SqlModuleWrapperError(`${this.commandType} is not valid value.`);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        public execute(): Promise<SqlCommandResponse> {\r\n\r\n            return new Promise((resolve, reject) => {\r\n                let res = new SqlCommandResponse();\r\n                let to = this._wrapperTimeoutMs;\r\n                if (to > 0) {\r\n                    setTimeout(to, () => {\r\n                        res.error = new SqlModuleWrapperError(`wrapper timeout ${to} expired.`);\r\n                        reject(res);\r\n                    });\r\n                }\r\n\r\n                this.dispatchCommandType(resolve, reject, res);\r\n\r\n                if (res.error != null) {\r\n                    reject(res);\r\n                } else if (this.subscribing()) {\r\n                    this.subscribe()\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    export class RawData implements RawData {\r\n        public meta: Meta[] = [];\r\n        public rows: Array<any[]> [];\r\n    }\r\n\r\n    export class SqlCommandResponse {\r\n\r\n        public aggregateRaw(raw: RawData) {\r\n            let rd = this.rawData;\r\n            if (rd == null) {\r\n                this.rawData = rd = new RawData();\r\n                rd.meta = raw.meta;\r\n                rd.rows = [];\r\n            }\r\n\r\n            raw.rows.forEach(row => rd.rows.push(row));\r\n            \r\n        }\r\n\r\n        public aggregate(rows: any[]) {\r\n            if (this.asObjects == null) {\r\n                this.asObjects = [];\r\n            }\r\n            rows.forEach(r => this.asObjects.push(r));\r\n        }\r\n\r\n        public error: Error | undefined;\r\n        public asObjects: any[] = [];\r\n        public outputParams: any[] | undefined;\r\n        public rawData: RawData | undefined;\r\n    }\r\n\r\n    export interface dictIteratorCb<T> { (key: string, val: T): void\r\n    }\r\n\r\n    export class Dictionary<T> {\r\n\r\n        container: {[id: string]: T;} = {};\r\n\r\n        public count(): number {\r\n            let keys = Object.keys(this.container);\r\n            return keys.length;\r\n        }\r\n\r\n        public values(): T[] {\r\n            let va: T[] = [];\r\n            let keys = Object.keys(this.container);\r\n            keys.forEach(k => va.push(this.container[k]));\r\n            return va;\r\n        }\r\n\r\n        public keys(): string[] {\r\n            return Object.keys(this.container);\r\n        }\r\n\r\n        public containsKey(key: string): boolean {\r\n            return this.container[key] != null;\r\n        }\r\n\r\n        public add(key: string, v: T): void {\r\n            if (this.containsKey(key)) throw new Error(`duplicate key ${key}`);\r\n            this.container[key] = v;\r\n        }\r\n\r\n        public remove(key: string): void {\r\n            delete this.container[key];\r\n        }\r\n\r\n        public get(key: string): T {\r\n            return this.container[key];\r\n        }\r\n\r\n        public forEach(cb: dictIteratorCb<T>) {\r\n            Object.keys(this.container).forEach((k: string) => cb(k, this.container[k]));\r\n        }\r\n    }\r\n\r\n    export class ConnectionPool {\r\n        connections: Dictionary<Connection> = new Dictionary<Connection>();\r\n    }\r\n\r\n    export class CommandCache {\r\n        public CachedCommands: Dictionary<SqlCommand> = new Dictionary<SqlCommand>();\r\n\r\n        constructor(public connection: SqlConnection) {\r\n        }\r\n\r\n        public get(id?: string): SqlCommand {\r\n            if (id == null) return new SqlCommand(this.connection);\r\n            let cached = this.CachedCommands.get(id);\r\n            if (cached == null) {\r\n                cached = new SqlCommand(this.connection);\r\n                this.CachedCommands.add(id, cached);\r\n            }\r\n            return cached;\r\n        }\r\n\r\n        public free(commandId?: string): Promise<string> {\r\n            return new Promise((resolve, reject) => {\r\n                let c: SqlCommand = this.CachedCommands.get(commandId);\r\n                if (c == null) {\r\n                    reject(false);\r\n                    return;\r\n                }\r\n                if (c.isPrepared()) {\r\n                    c.freePrepared().then(() => {\r\n                        this.CachedCommands.remove(commandId);\r\n                        resolve(commandId);\r\n                    });\r\n                } else {\r\n                    this.CachedCommands.remove(commandId);\r\n                    resolve(commandId);\r\n                }\r\n            });\r\n        }\r\n\r\n        public deleteAll(): Promise<boolean> {\r\n            return new Promise((resolve, reject) => {\r\n                this.CachedCommands.forEach((id, c) => {\r\n                    this.free(id).then(()=> {\r\n                        if (this.CachedCommands.count() == 0) {\r\n                            resolve(true);\r\n                        }\r\n                    }).catch(e => {\r\n                        reject(e);\r\n                    })\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    export class SqlConnection {\r\n\r\n        public CommandCache: CommandCache;\r\n\r\n        constructor(public legacy_conn: Connection) {\r\n            this.CommandCache = new CommandCache(this);\r\n        }\r\n\r\n        public id(): string {\r\n            return this.legacy_conn.id.toString();\r\n        }\r\n\r\n        public getCommand() : SqlCommand {\r\n            return new SqlCommand(this);\r\n        }\r\n\r\n        public static getLegacy(): SqlClient {\r\n            return legacyDriver;\r\n        }\r\n\r\n        public close(): Promise<any> {\r\n            return new Promise((resolve, reject) => {\r\n                this.legacy_conn.close((err: Error) => {\r\n                    if (err) reject(err);\r\n                    else resolve();\r\n                })\r\n            });\r\n        }\r\n    }\r\n\r\n    export class Sql {\r\n\r\n        constructor(public connStr: string) {\r\n        }\r\n\r\n        public execute(sql:string, params:any = [], raw:boolean = false) : Promise<SqlCommandResponse> {\r\n            return new Promise((resolve, reject) => {\r\n                this.open().then( (connection : SqlConnection) => {\r\n                    let command = new SqlCommand(connection);\r\n                    if (raw) command = command.rawFormat();\r\n                    command.sql(sql).params(params).execute().then(res=> {\r\n                        connection.close().then(() => {\r\n                            resolve(res);\r\n                        }).catch(e=>{\r\n                            reject(e);\r\n                        });\r\n                    }).catch(e=> {\r\n                        reject(e);\r\n                    })\r\n                }).catch(e=> {\r\n                    reject(e);\r\n                });\r\n            });\r\n        }\r\n\r\n        public open(timeout: number = 0): Promise<SqlConnection> {\r\n            return new Promise((resolve, reject) => {\r\n                legacyDriver.open({\r\n                    conn_str: this.connStr,\r\n                    conn_timeout: timeout\r\n                }, (err: Error, legacy: any) => {\r\n                    if (err) {\r\n                        reject(err);\r\n                    } else {\r\n                        let connection = new SqlConnection(legacy);\r\n                        resolve(connection);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n}"]}